{"title":"Correlation and Regression Models","markdown":{"yaml":{"title":"Correlation and Regression Models ","subtitle":"Part 2","author":"Esteban Montenegro-Montenegro, PhD","institute":"Psychology and Child Development","title-slide-attributes":{"data-background-image":"background1.png","data-background-opacity":"0.5"},"format":{"revealjs":{"theme":["default","custom.scss"],"slide-number":true,"self-contained":false,"chalkboard":{"theme":"whiteboard"}}},"editor":"visual","bibliography":"references.bib","csl":"apa.csl"},"headingText":"My aims in this lecture","headingAttr":{"id":"","classes":["smaller","scrollable"],"keyvalue":[["background-image","slide2.png"],["background-opacity","0.5"]]},"containsRefs":false,"markdown":"\n\n\n-   To introduce basic notions of the regression model\n\n-   To start thinking about statistical models with more variables (exciting times!)\n\n-   To encourage you to think about more realistic research questions (this might take several sessions!)\n\n```{r}\nlibrary(knitr)\nlibrary(kableExtra)\nlibrary(dplyr)\nlibrary(gghighlight)\nlibrary(ISLR)\nlibrary(DT)\n```\n\n## What is a regression model ? {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-   You might be thinking, is regression something related that happened in the past?\n\n-   Is related to study something that might happen in the future?\n\n-   Regression is a weird word!\n\n![](regre.jpg)\n\n## What is a regression model ? (cont.) {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\nIn this lecture we will follow ideas from @westfall2020understanding:\n\n-   Regression models are used to relate a variable $Y$ with a single variable $X$ or multiple variables $X_{1}, X_{2}, ..., X_{k}$\n\n-   Some questions that you might answer with a regression model:\n\n-   How does a person's choice of toothpaste ($Y$) relate to the person's age ($X_{1}$) and income ($X_{2}$)?\n\n-   How does a person's cancer remission status ($Y$) relate to their chemotherapy regimen ($X$)?\n\n-   How does a person's self-esteem ($Y$) relates to time in social media ($X_{1}$) and number of followers ($X_{2}$)\n\n## What is a regression model ? (cont.) {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-   A regression model can help you to *predict* what an unknown $Y$ will be for a given fixed value of $X$. Prediction is more like a ***\"what-if\"*** analysis. It is a prediction about the future but also , you can answer **what might have happened** in the past.\n\n-   A regression model can be represented as:\n\n```{=tex}\n\\begin{equation}\nY|X = x \\sim p(y|x)\n\\end{equation}\n```\n-   This means the expression $p(y|X=x)$ is the distribution of potentially observable $Y$ values when $X = x$, and is called the ***conditional distribution*** of $Y$, given that $X = x$.\n\n-   In simple words, in regression we are estimating a conditional distribution. I know that we are going fast in this class, but the examples and the exercises in this class my help later.\n\n-   We can also represent the regression model as $p(y|x)$. It is shorter!\n\n## We can talk more about conditional distributions {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-   Let's imagine you need to predict the development of episodic memory in humans. You will need to use age of the individual to predict their memory score. Let's imagine you want to predict the probability of the memory score ($X$) when age = 27 years old. But also, you need predict the memory score when individuals are 5 years old.\n\n-   The model $p(y|x)$ does not assume any distribution, it doesn't assume whether the distribution is discrete or continuous. But we will use a Gaussian process to represent the conditional statements $p(y|X=27)$ and $p(y|X = 5)$\n\n## We can talk more about conditional distributions (cont.) {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-   The model only assumes that there is a distribution of possible values in Nature when age = 27 and age = 5\n\n```{r, echo=FALSE, message=FALSE,error=FALSE}\nlibrary(ggplot2)\nset.seed(12369)\n\nage5 <- rnorm(1000, 30, 29)\n\nage27 <- rnorm(1000, 50, 10)\n\n\ndat1 <- data.frame(score= c(age5,age27), \n                   age = c(rep(\"age5\", 1000), rep(\"age27\",1000)))\n                   \n\nggplot(dat1, aes(x=score, color=age)) +\n  geom_density() +\n  xlab(\"memory score, y variable\")+\n  ylab(\"p(y|x)\") +\n  ggtitle(\"Possible conditional distributon of a episodic memory score test\")+\n  theme_classic()\n  \n  \n```\n\n## But soon we will assume a distribution {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n@westfall2020understanding:\n\n| When p(y\\|x) are Assumed to be: | Then you have...                |\n|---------------------------------|---------------------------------|\n| Poisson                         | Poisson regression              |\n| Negative binomial               | Negative binomial regression    |\n| Bernoulli                       | Logistic regression             |\n| Normal                          | Classical regression            |\n| Multinomial                     | Multinomial logistic regression |\n| Beta                            | Beta regression                 |\n| Lognormal                       | Lognormal regression            |\n\n: Families of conditional distributions\n\n-   This is not a final list of possible regression models, but at least the most popular ones.\n-   We won't have time to study all of them, in the best scenario we will study three different regression models: **Poisson regression, Logistic regression, and Classical regression.**\n\n## Important to remember! {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n@westfall2020understanding:\n\n::: callout-important\n***The regression model*** $p(y|x)$ does not come from the data. Rather, the regression model $p(y|x)$ is assumed to produce the data.\n:::\n\n-   Models produce data, data DOES NOT produce models!\n\n## Variable $X$ and Variable $Y$: Beasts of many names {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-   **In regression you'll find several names for** $X$:\n\n    -   predictor variable(s)\n    -   descriptor variable(s)\n    -   feature variable(s)\n    -   independent variable(s)\n    -   exogenous variable(s)\n    -   response/predictor\n\n-   **Also several names for** $Y$:\n\n    -   response variable\n    -   target variable\n    -   criterion variable\n    -   dependent variable\n    -   endogenous variable\n\n## Variable $X$ and Variable $Y$: Beasts of many names {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-   The **DATA** in regression models looks like this:\n\n![](data.png)\n\n## Example Time {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-   Let's do preliminary model:\n\n    -   This is the data named `\"Wage\"` it comes from the package `ISLR`. It has information of variables related to wages for a group of males from the Atlantic region of the United States.\n\n```{r, echo=TRUE}\nlibrary(ISLR)\nlibrary(DT)\n\ndatatable(Wage)\n\n```\n\n## Example Time (cont.) {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\nLet's fit a regression model were `age` will be a predictor of `wage`. This means $X = age$ and $Y= wage$ :\n\n```{r, echo=TRUE}\n\nfitModel <- lm(wage ~ age, data = Wage)\nsummary(fitModel)\n\n```\n\n-   The estimate column shows two important rows, the first one is the ***intercept*** this is the starting point of a line (more about it later). The second row is an estimate for ***age*** this is called the ***slope***. It tells you the rate of change.\n\n-   In this case it is telling us that, for each year of age, these males earned $0.70728*1000=\\$707.28$ more. We'll talk about it later.\n\n## Example Time (cont.) {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n```{r, echo=TRUE}\nggplot(data = Wage, aes(x=age, y=wage)) +\n  geom_point()+ geom_smooth(method = \"lm\")+\n  theme_classic()\n```\n\n# It is time for assumptions! {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n## Classical Regression Model {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-   The model that we just ran is named **Classical Regression Model**, many people call it **linear regression**, other people call it **Gaussian regression**.\n\n-   I prefer to call it ***Classical Regression Model*** [@westfall2020understanding].\n\n-   This is how the model looks like in many books:\n\n```{=tex}\n\\begin{equation}\nY = \\beta_{0}+ \\beta_{1}X + \\epsilon \n\\end{equation}\n```\n-   We will talk about this model very often, but before going straight to bussiness we need to talk about assumptions.\n\n## Classical Regression Model: Assumptions {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-   Remember: Models produce data! Then, models are explanations of what happens in Nature.\n\n-   The first assumption is **randomness**, many books only assume this concept but it doesn't hurt to make it explicit.\n\n-   **Randomness** in this context means that:\n\n::: callout-note\nThe value of $Y$ is variable, coming *randomly* from a distribution $p(y|x)$ of potentially observable $Y$ values that is specific to the particular values ($X = x$) of the $X$ variables [@westfall2020understanding].\n:::\n\n-   In simple words, we assume $Y$ is variable produced randomly by a conditional distribution $p(y|X)$.\n\n-   But of course, we test if there is a dependency between $y$ and $x$. That's part of the job.\n\n## Classical Regression Model: Assumptions (cont.) {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-   Remember when I showed you that $p(y|x)$ is assuming a distribution for each $x$?\n\n-   There is a *conditional mean function* in the Classical Regression Model, the expression looks like this:\n\n```{=tex}\n\\begin{equation}\nf(x) = E(Y|X=x)\n\\end{equation}\n```\nIn this formula $E$ means expectation or expected value. In this case the expected value is the collection of means of the conditional distributions.\n\n## Classical Regression Model: Assumptions (cont.) {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-   There is an assumption of **constant variance (homoscedasticity)**.\n\n-   Given that we are assuming there are several distributions, each $x$ has a distribution, we also assume that the variance in this conditional distributions is the same or constant.\n\n::: callout-note\nThe variances of the conditional distributions $p(y|x)$ are constant (i.e., they are all the same number, $\\sigma^2$) for all specific values $X = x$ [@westfall2020understanding].\n:::\n\n## Classical Regression Model: Assumptions (cont.) {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-   There an important assumption which is ***normality***.\n\n-   The Classical Regression Model or linear model, assumes all the conditional distributions are produced by a normal distribution or Gaussian distribution.\n\n::: callout-note\nThe conditional probability distribution functions $p(y|x)$ are normal distributions (as opposed to Bernoulli, Poisson, or other) for every $X = x$.[@westfall2020understanding].\n:::\n\n## Classical Regression Model: Assumptions (cont.) {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n@westfall2020understanding:\n\n![](regressionModel.png)\n\n## Classical Regression Model: Assumptions (cont.) {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n::: columns\n::: {.column width=\"40%\"}\n-   There is also an assumption of linearity.\n\n-   This assumption states that the means of the conditional distributions $p(y|x)$ fall precisely on a straight line of the form $\\beta_{0} + \\beta_{1}x$\n\n-   When we assume linearity the parameter $\\beta_{O}$ is the mean of $Y$ when the parameter $\\beta_{1} = 0$.\n\n-   To make $\\beta_{1} = 0$ we would just need to multiply it by zero: $\\beta_{0} + \\beta_{1}(0)$.\n\n-   But, what happens if $x$ does not have zero? Well, in that case, $\\beta_{0}$ would not be exactly the mean of $Y$ , instead $\\beta_{0}$ would be the vertical height or distance from zero.\n\n-   In this case, $\\beta_{1}$ is a parameter that indicates the difference between conditional means.\n:::\n\n::: {.column width=\"60%\"}\n@westfall2020understanding: ![](regress2.png)\n:::\n:::\n\n## Ordinary Least Squares {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-   I have mentioned before in class, the existence of a *line of best fit*\n\n-   This is the time to study what is this line.\n\n-   One fo the estimation methods in the Classical Regression Model is ***Ordinary Least Squares*** estimation.\n\n-   In this method, we draw a line in every possible direction, and calculate the distance of each value from the line. After calculating the distance form the line, we square those distances and add them together. This is what we call a Sum of Squares. The line that produces the lowest *Sum of Squares* is the ***line of best fit***.\n\n::: {#fig-plots layout-ncol=\"2\"}\n![](bestFit.png)\n\n![](sse.png)\n\n@field2012discovering and @westfall2020understanding\n:::\n\n## `Wage` data example {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-   By this point we should talk more about our applied example.\n\n-   Let's see what happens when we assume $\\beta_{1} = 0$ by just removing `age` from the regression model.\n\n```{r, echo=TRUE}\n\nfitModel <- lm(wage ~ 1, data = Wage)\nsummary(fitModel)\n\n```\n\n-   This is what we call the ***intercept only model***, it can also be considered a null model. Remember those words? In this model, we are not modeling any relationship. The regression model returns exactly the mean of `wage`. If you don't believe me you can see it:\n\n```{r, echo=TRUE}\nmean(Wage$wage)\n```\n\n-   It is the same value as the intercept!\n\n-   Let's add again `age` as a predictor:\n\n```{r, echo=TRUE}\n\nfitModel <- lm(wage ~ age, data = Wage)\nsummary(fitModel)\n\n```\n\n-   Now the coefficient for the estimated intercept changed. This happened because now the intercept represents the average wage when `age` is zero. But wait, you cannot have a zero age and get a salary? In this case, the intercept misses the interpretation, then it represents the height from zero.\n\n## `Wage` data example {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n```{r, echo = TRUE}\n#| code-fold: true\n#| code-summary: \"Show the code\"\n#| \nplot(Wage$age, Wage$wage, \n     pch = 16, \n     cex = 0.7, \n     col = \"blue\",\n     xlab = \"Age\",\n     ylab = \"Wage\",\n     main = \"Line of Best Fit Linear Regression\")\nabline(lm(wage ~ age, data = Wage), col = \"red\")\n\n\n```\n\n## `Wage` data example {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-   If we want to interpret the intercept in the way the linear model specifies. We can transform `age` to get a meaningful zero.\n\n-   There is something call $z$-values, others call it $z$-scores. This tranformation is based on the normal distribution.\n\n-   Let's see the formula to transform any continuous distribution into $z$ values:\n\n```{=tex}\n\\begin{equation}\nz= \\frac{x_{i}-\\bar{x}}{\\sigma}\n\\end{equation}\n```\nWhere: - $x_{i}$ is each observed value. - $\\bar{x}$ is the mean of the observed values. - $\\sigma$ is the standard deviation of the observed values.\n\n-   As you can see, what we do is to tranform the distribution, now the observed values will be centered at zero. It means the mean is going to be zero, and the values will be negative and positive values.\n\n-   In `R` you can transform any continiuos distributin into $z$-values using the function `scale()`.\n\n```{r, echo=TRUE}\nWage$age_Z <- scale(Wage$age)\nsummary(Wage[, c(\"age\", \"age_Z\")])\n```\n\n-   In the example above, you can see that the mean of `age` is now zero after transforming the distribution. Also, notice that `age_Z` ranges from -2.12 to 3.26.\n\n-   Given that now we have $z$-values we can interpret the values in terms of standard deviations from the mean. For instance, we can say that 18 years old is a value located -2.12 standard deviation below the mean (because the value is negative), we can also say that 80 years old is a value located 3.26 standard deviations above the mean (because the value is positive)\n\n## `Wage` data example {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\nLet's add `age_Z` variable to our regression model:\n\n```{r, echo = TRUE}\n#| code-fold: true\n#| code-summary: \"Show the code\"\n\nfitModel <- lm(wage ~ age_Z, data = Wage)\nsummary(fitModel)\n```\n\n-   Do you see what happened? After transforming `age` into values with a real zero, the intercept now shows the mean of `wage`. If you don't believe it, let's estimate again the mean of `wage`:\n\n```{r, echo=TRUE}\nmean(Wage$wage)\n```\n\n-   It is the same number! Then it is true, the intercept is the mean of $Y$ when $\\beta_{1}$ has a real zero among the possible values.\n\n-   Then we can interpret the result as: for 1-unit increment in `age_Z`, `wage` increases \\$816.37. Also you can say: for 1-standard deviation increment, `wage` increases \\$816.37.\n\n## `Wage` data example {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-   We can also transform `wage` into $z$-values, this will make the interpretation *fully standardized*:\n\n```{r, echo = TRUE}\n#| code-fold: true\n#| code-summary: \"Show the code\"\noptions(scipen = 999)\n\nWage$wage_Z <- scale(Wage$wage)\n\nsummary(lm(wage_Z ~ age_Z, data = Wage))\n\n```\n\n-   After standardizing `wage` we have an intercept that is almost zero, this makes sense because the mean of `wage` is now zero. It is actually zero, but models are not perfect, they are approximations, and there is randomness, that's why the intercept is not exactly zero.\n\n-   In this model, we could interpret the estimate of `age_Z` like it was a correlation, because it is standardized. We can also say: for 1-standard deviation increase in `age`, `wage` increases 0.20 standard deviations.\n\n## Fun fact: $t$-test is a linear regression extension {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-   Up to this point I have talked only about the case where the predictor has a continuous distribution. But, what happens when our predictor has discrete values (e.g gender, academic level)?\n\n-   The Classical Regression Models does not assume anything about the predictors. We can actually use any discrete variable.\n\n-   As always, we can understand what happens with a ***binary*** predictor by running an example:\n\n```{r, echo=TRUE}\n#| code-fold: true\n#| code-summary: \"Show the code\"\n\n### I'm going to transform the values, so I can get a variable where 1 = have insurance, 0 = does not have insurance.\n\nWage$dummyHealth <- ifelse(Wage$health_ins == \"2. No\", 0, 1)  ### This is a \"if else statement\".\n\n## Let's test if having an insurance predicts differences in wage\n\nfitWage <- lm(wage ~ dummyHealth, data = Wage)\n\nsummary(fitWage)\n\n```\n\n-   Let's digest the information from this example:\n\n    -   The model that we are fitting looks like this: $y_{wage} = \\beta_{0} + \\beta_{1}insuranceYES + \\epsilon$.\n    -   When the variable is discrete there is a reference group. Normally, the reference group is coded as $0$ and the target group is coded as $1$. This is tipically known as ***dummy coding***.\n\n-   The above table gave a value for the intercept. That intercept, in simple words; is the mean when $dummyHealth = 0$. The slope in the table is 27.922, that number is in simple terms ***the mean difference in wage between groups***.\n\n-   Don't you believe it? Let's see it next:\n\n## Fun fact: $t$-test is a linear regression extension {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\nFirst, let's see the mean of each group:\n\n```{r, echo=TRUE}\n#| code-fold: true\n#| code-summary: \"Show the code\"\n\nWage %>% select(dummyHealth, wage) %>% \n  group_by(dummyHealth) %>%\n  summarise(mean = mean(wage),\n            sd = sd(wage)) %>%\n  kbl(caption = \"Wage's mean and standard deviation by insurance status\") %>%\nkable_classic_2(\"hover\", full_width = F,bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\")) %>%\n  footnote(general = \"Not insurance = 0, Insurance = 1\")\n\n\n```\n\n-   In the table you can see that the mean of $Insurance = 0$ is 92.32! Just like we expected!\n\n-   Now let's compute the mean difference:\n\n```{r, echo=TRUE}\n\n120.2383-92.3167\n\n```\n\n-   Again! If you check our regression result the slope was 27.922, that's exactly the mean difference!\n\n-   What is the message here? When add ***dummy coded variables*** in a Classical Regression Model, you are measuring how far is the mean of $group = 0$ from $group = 1$, it simple words: ***it is a*** $t$-test.\n\n## Fun fact: $t$-test is a linear regression extension {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-Let's see it with a plot\n\n```{r, echo=TRUE}\n#| code-fold: true\n#| code-summary: \"Show the code\"\n\nplot(Wage$dummyHealth, Wage$wage,\n     xlab = \"Insurance Status\",\n     ylab = \"Wage\",\n     main = \"A scatterplot of wage by insurance status\",\n     xaxt = \"n\")\n\n# X-axis\naxis(1, at = c(0, 1))\nabline(lm(wage ~ dummyHealth, data = Wage), col = \"red\")\n```\n\n## What if my predictor has multiple categories? {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-   You might wonder, what if my predictor has multiple groups?\n\n-   We can also transform multiple categories into several *dummy coded* variables, that means, the categories will become variables coded with $0$ or $1$.\n\n-   We can answer the following question:\n\n-   Is race related to wage? If so, how different is the average wage compared to White Americans?\n\n-   In the data set `Wage` there is a variable named `race`. We can check its values:\n\n```{r, echo=TRUE}\n#| code-fold: true\n#| code-summary: \"Show the code\"\n Wage %>% count(race) %>%\n   kbl(caption = \"Number of participants in each race group\")%>%\n  kable_classic_2(\"hover\", \n                  full_width = F,\n                  bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\"))\n```\n\n-   As you can see, we have 4 groups in this variable, and we need to create dummy variables.\n\n-   We should create $k-1$ new dummy variables, that means if you have 4 categories or groups, such as our case, we should have $4-1= 3$ new dummy variables:\n\n| Black | Asian | Other |\n|-------|-------|-------|\n| 0     | 0     | 0     |\n| 1     | 1     | 1     |\n| 0     | 1     | 1     |\n| ...   | ...   | ....  |\n\n-   Now we will create 3 new variables named `black`, `asian`, and `other`. Each variable will have only zeros and ones. Where $1 = YES$, and $0 = NO$.\n\n```{r, echo=TRUE}\n#| code-fold: true\n#| code-summary: \"Show the code\"\n\nWage <- Wage %>% mutate(black = ifelse(race == \"2. Black\", 1, 0),\n                        asian = ifelse(race == \"3. Asian\", 1, 0),\n                        other = ifelse(race == \"4. Other\", 1,0))\n\ndatatable(Wage %>% select(race, black,asian,other))\n\n```\n\n-   We are ready to estimate the regression model:\n\n```{r, echo=TRUE}\n#| code-fold: true\n#| code-summary: \"Show the code\"\n\nsummary(lm(wage ~ black + asian + other, data = Wage))\n\n```\n\n-   Did you notice that `white` is not in the model? That happens because we don't need it!\n\n-   If you do $k-1$ new dummy variables, you are already estimating the mean of `white` in the intercept.\n\n-   You don't believe me, right? Let's estimate the mean of white:\n\n```{r, echo=TRUE}\n#| code-fold: true\n#| code-summary: \"Show the code\"\n#| \nWage %>% filter(race == \"1. White\" ) %>%\n  summarise(mean = mean(wage),\n            sd = sd(wage)) %>%\n  kbl(caption = \"Mean of wage when participant is White\") %>%\n  kable_classic_2(\"hover\", \n                  full_width = F,\n                  bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\"))\n```\n\n-   Yes! I was right! The mean of white is exactly our intercept!\n\n-   Each slope estimated in our regression model is the mean difference compare to `white` group.\n\n-   Let's see if it true:\n\n```{r}\n#| code-fold: true\n#| code-summary: \"Show the code\"\n\nWage %>% group_by(race) %>% summarise(mean = mean(wage)) %>%\n  mutate(DifferenceVsWhite = c(0, \n                               101.60118\t- 112.56367\t, \n                               120.28829- 112.56367\t, \n                               89.97333 -112.56367)) %>% \n  kbl(caption = \"Mean Differences Compare to White\") %>%\n    kable_classic_2(\"hover\", \n                  full_width = F,\n                  bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\"))\n```\n\n-   Great! I was right again!\n\n# This is boring, let's add more predictor! {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n\n\n\n## Multiple predictors went to a bar... {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n- In the last example we added multiple predictors after creating ***dummy coded*** variables.\n\n- We estimated a model named *multiple regression*. Many authors prefered the word *multiple*\nto explicitly mention that there are more than one predictor. \n\n- When you add more predictors, the Classical Regression Model looks like this:\n\n\n```{=tex}\n\\begin{equation}\nY = \\beta_{0}+ \\beta_{1}X_{1} + \\beta_{2}X_{2} + ...+ \\epsilon \n\\end{equation}\n```\n\n- Now, this model will account for more possible variables related to $Y$.\n\n\n## Multiple predictors went to a bar... {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n\n\n```{r, echo=TRUE}\n#| code-fold: true\n#| code-summary: \"Show the code\"\n\nlibrary(scatterplot3d)\nrum <- read.csv(\"ruminationClean.csv\")\nfit <- lm(depreZ ~ rumZ + worryZ, data = rum)\n\nplot1 <- scatterplot3d(rum[c(\"rumZ\",\"worryZ\", \"depreZ\"  )], \n              angle = 60, \n              pch = 16,\n              color = \"steelblue\",\n              box = FALSE)\nplot1$plane3d(fit)\n\n\n```\n\n## Multiple predictors went to a bar... {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n- In the last example, I standardized the my outcome variable `depression`, I \nalso standardized the predictors `rumination` and `worry`. \n\n- I showed you that transforming the predictors and outcome unto $z$-values will \nhelp you to get stadardized estimates.\n\n-  This is not always necessary, may software will do something like this:\n\n\\begin{equation}\n r_{XY} = \\beta_{1}\\Big(\\frac{\\sigma_{X}}{\\sigma_{Y}}\\Big)\n\\end{equation}\n\n-Let's see if it works, I'll run a regression with the raw data and compare versus\na regression where I standardized the variables before fitting the model:\n\n\n\n```{r, echo = TRUE}\nsummary(lm(anx ~ worry, data = rum))\n\n```\n\n- Next, let's estimate the standarized slope:\n\n\n```{r, echo = TRUE}\n0.14384*(sd(rum$worry, na.rm = TRUE)/sd(rum$anx, na.rm = TRUE))\n\n```\n- Let's run again the same regression with standardized trasformed variables:\n\n```{r, echo=TRUE}\nsummary(lm(scale(anx) ~ worryZ, data = rum))\n```\n\n- Yes, they are the same. The software by default will use the  formula$\\beta_{1}\\Big(\\frac{\\sigma_{X}}{\\sigma_{Y}}\\Big)$ to standardize\nyour regression slopes, when you analyze your data using SPSS, SAS, STATA or\nother statistical packages outside `R`.\n\n\n\n## Multiple predictors went to a bar: non-linear models {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n- We have discussed that the assumption of a straight line\nexplaining all the conditional means is many times \nnot realistic. \n\n- We can actually fit a model where we give more freedom to the line.\n\n- How do we do this? We just have to add a polynomial term\nto the equation. For instance we could fit a quadractic \nregression model by doing something like this:\n\n\n```{=tex}\n\\begin{equation}\nY = \\beta_{0}+ \\beta_{1}X + \\beta_{2}X^2 + \\epsilon \n\\end{equation}\n```\n\n- Simply, we square the predictor. Let's do that with our `wage` data example:\n\n\n\n```{r, echo=TRUE}\n\n\nfitSq <- lm(wage ~ age + I(age^2), data = Wage)\nsummary(fitSq)\n\n```\n\n## Multiple predictors went to a bar: non-linear models {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n```{r, echo=TRUE}\n#| code-fold: true\n#| code-summary: \"Show the code\"\n#| \nggplot(Wage, aes(age, wage)) +\n      geom_point() +\n      stat_smooth(method = \"lm\", \n                  formula = y ~ x + I(x^2), \n                  size = 1) + \n  theme_classic()\n```\n\n## Multiple predictors went to a bar: non-linear models {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n- We could fit a model with a cubic term:\n\n```{=tex}\n\\begin{equation}\nY = \\beta_{0}+ \\beta_{1}X + \\beta_{2}X^2 + \\beta_{2}X^3 + \\epsilon \n\\end{equation}\n```\n\n\n\n```{r, echo=TRUE}\n#| code-fold: true\n#| code-summary: \"Show the code\"\n#| \nggplot(Wage, aes(age, wage)) +\n      geom_point() +\n      stat_smooth(method = \"lm\", \n                  formula = y ~ x + I(x^2) + I(x^3), \n                  size = 1) + \n  theme_classic()\n```\n\n## Multiple predictors went to a bar: non-linear models {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n- Let's add more flexibility:\n\n\n```{r, echo=TRUE}\n#| code-fold: true\n#| code-summary: \"Show the code\"\n#| \nggplot(Wage, aes(age, wage)) +\n      geom_point() +\n      stat_smooth(method = \"lm\", \n                  formula = y ~ x + I(x^2) + I(x^3) + I(x^4)+ I(x^5), \n                  size = 1) + \n  theme_classic()\n```\n\n\n\n## References {background-image=\"slide2.png\" background-opacity=\"0.5\"}\n","srcMarkdownNoYaml":"\n\n## My aims in this lecture {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-   To introduce basic notions of the regression model\n\n-   To start thinking about statistical models with more variables (exciting times!)\n\n-   To encourage you to think about more realistic research questions (this might take several sessions!)\n\n```{r}\nlibrary(knitr)\nlibrary(kableExtra)\nlibrary(dplyr)\nlibrary(gghighlight)\nlibrary(ISLR)\nlibrary(DT)\n```\n\n## What is a regression model ? {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-   You might be thinking, is regression something related that happened in the past?\n\n-   Is related to study something that might happen in the future?\n\n-   Regression is a weird word!\n\n![](regre.jpg)\n\n## What is a regression model ? (cont.) {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\nIn this lecture we will follow ideas from @westfall2020understanding:\n\n-   Regression models are used to relate a variable $Y$ with a single variable $X$ or multiple variables $X_{1}, X_{2}, ..., X_{k}$\n\n-   Some questions that you might answer with a regression model:\n\n-   How does a person's choice of toothpaste ($Y$) relate to the person's age ($X_{1}$) and income ($X_{2}$)?\n\n-   How does a person's cancer remission status ($Y$) relate to their chemotherapy regimen ($X$)?\n\n-   How does a person's self-esteem ($Y$) relates to time in social media ($X_{1}$) and number of followers ($X_{2}$)\n\n## What is a regression model ? (cont.) {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-   A regression model can help you to *predict* what an unknown $Y$ will be for a given fixed value of $X$. Prediction is more like a ***\"what-if\"*** analysis. It is a prediction about the future but also , you can answer **what might have happened** in the past.\n\n-   A regression model can be represented as:\n\n```{=tex}\n\\begin{equation}\nY|X = x \\sim p(y|x)\n\\end{equation}\n```\n-   This means the expression $p(y|X=x)$ is the distribution of potentially observable $Y$ values when $X = x$, and is called the ***conditional distribution*** of $Y$, given that $X = x$.\n\n-   In simple words, in regression we are estimating a conditional distribution. I know that we are going fast in this class, but the examples and the exercises in this class my help later.\n\n-   We can also represent the regression model as $p(y|x)$. It is shorter!\n\n## We can talk more about conditional distributions {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-   Let's imagine you need to predict the development of episodic memory in humans. You will need to use age of the individual to predict their memory score. Let's imagine you want to predict the probability of the memory score ($X$) when age = 27 years old. But also, you need predict the memory score when individuals are 5 years old.\n\n-   The model $p(y|x)$ does not assume any distribution, it doesn't assume whether the distribution is discrete or continuous. But we will use a Gaussian process to represent the conditional statements $p(y|X=27)$ and $p(y|X = 5)$\n\n## We can talk more about conditional distributions (cont.) {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-   The model only assumes that there is a distribution of possible values in Nature when age = 27 and age = 5\n\n```{r, echo=FALSE, message=FALSE,error=FALSE}\nlibrary(ggplot2)\nset.seed(12369)\n\nage5 <- rnorm(1000, 30, 29)\n\nage27 <- rnorm(1000, 50, 10)\n\n\ndat1 <- data.frame(score= c(age5,age27), \n                   age = c(rep(\"age5\", 1000), rep(\"age27\",1000)))\n                   \n\nggplot(dat1, aes(x=score, color=age)) +\n  geom_density() +\n  xlab(\"memory score, y variable\")+\n  ylab(\"p(y|x)\") +\n  ggtitle(\"Possible conditional distributon of a episodic memory score test\")+\n  theme_classic()\n  \n  \n```\n\n## But soon we will assume a distribution {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n@westfall2020understanding:\n\n| When p(y\\|x) are Assumed to be: | Then you have...                |\n|---------------------------------|---------------------------------|\n| Poisson                         | Poisson regression              |\n| Negative binomial               | Negative binomial regression    |\n| Bernoulli                       | Logistic regression             |\n| Normal                          | Classical regression            |\n| Multinomial                     | Multinomial logistic regression |\n| Beta                            | Beta regression                 |\n| Lognormal                       | Lognormal regression            |\n\n: Families of conditional distributions\n\n-   This is not a final list of possible regression models, but at least the most popular ones.\n-   We won't have time to study all of them, in the best scenario we will study three different regression models: **Poisson regression, Logistic regression, and Classical regression.**\n\n## Important to remember! {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n@westfall2020understanding:\n\n::: callout-important\n***The regression model*** $p(y|x)$ does not come from the data. Rather, the regression model $p(y|x)$ is assumed to produce the data.\n:::\n\n-   Models produce data, data DOES NOT produce models!\n\n## Variable $X$ and Variable $Y$: Beasts of many names {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-   **In regression you'll find several names for** $X$:\n\n    -   predictor variable(s)\n    -   descriptor variable(s)\n    -   feature variable(s)\n    -   independent variable(s)\n    -   exogenous variable(s)\n    -   response/predictor\n\n-   **Also several names for** $Y$:\n\n    -   response variable\n    -   target variable\n    -   criterion variable\n    -   dependent variable\n    -   endogenous variable\n\n## Variable $X$ and Variable $Y$: Beasts of many names {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-   The **DATA** in regression models looks like this:\n\n![](data.png)\n\n## Example Time {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-   Let's do preliminary model:\n\n    -   This is the data named `\"Wage\"` it comes from the package `ISLR`. It has information of variables related to wages for a group of males from the Atlantic region of the United States.\n\n```{r, echo=TRUE}\nlibrary(ISLR)\nlibrary(DT)\n\ndatatable(Wage)\n\n```\n\n## Example Time (cont.) {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\nLet's fit a regression model were `age` will be a predictor of `wage`. This means $X = age$ and $Y= wage$ :\n\n```{r, echo=TRUE}\n\nfitModel <- lm(wage ~ age, data = Wage)\nsummary(fitModel)\n\n```\n\n-   The estimate column shows two important rows, the first one is the ***intercept*** this is the starting point of a line (more about it later). The second row is an estimate for ***age*** this is called the ***slope***. It tells you the rate of change.\n\n-   In this case it is telling us that, for each year of age, these males earned $0.70728*1000=\\$707.28$ more. We'll talk about it later.\n\n## Example Time (cont.) {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n```{r, echo=TRUE}\nggplot(data = Wage, aes(x=age, y=wage)) +\n  geom_point()+ geom_smooth(method = \"lm\")+\n  theme_classic()\n```\n\n# It is time for assumptions! {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n## Classical Regression Model {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-   The model that we just ran is named **Classical Regression Model**, many people call it **linear regression**, other people call it **Gaussian regression**.\n\n-   I prefer to call it ***Classical Regression Model*** [@westfall2020understanding].\n\n-   This is how the model looks like in many books:\n\n```{=tex}\n\\begin{equation}\nY = \\beta_{0}+ \\beta_{1}X + \\epsilon \n\\end{equation}\n```\n-   We will talk about this model very often, but before going straight to bussiness we need to talk about assumptions.\n\n## Classical Regression Model: Assumptions {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-   Remember: Models produce data! Then, models are explanations of what happens in Nature.\n\n-   The first assumption is **randomness**, many books only assume this concept but it doesn't hurt to make it explicit.\n\n-   **Randomness** in this context means that:\n\n::: callout-note\nThe value of $Y$ is variable, coming *randomly* from a distribution $p(y|x)$ of potentially observable $Y$ values that is specific to the particular values ($X = x$) of the $X$ variables [@westfall2020understanding].\n:::\n\n-   In simple words, we assume $Y$ is variable produced randomly by a conditional distribution $p(y|X)$.\n\n-   But of course, we test if there is a dependency between $y$ and $x$. That's part of the job.\n\n## Classical Regression Model: Assumptions (cont.) {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-   Remember when I showed you that $p(y|x)$ is assuming a distribution for each $x$?\n\n-   There is a *conditional mean function* in the Classical Regression Model, the expression looks like this:\n\n```{=tex}\n\\begin{equation}\nf(x) = E(Y|X=x)\n\\end{equation}\n```\nIn this formula $E$ means expectation or expected value. In this case the expected value is the collection of means of the conditional distributions.\n\n## Classical Regression Model: Assumptions (cont.) {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-   There is an assumption of **constant variance (homoscedasticity)**.\n\n-   Given that we are assuming there are several distributions, each $x$ has a distribution, we also assume that the variance in this conditional distributions is the same or constant.\n\n::: callout-note\nThe variances of the conditional distributions $p(y|x)$ are constant (i.e., they are all the same number, $\\sigma^2$) for all specific values $X = x$ [@westfall2020understanding].\n:::\n\n## Classical Regression Model: Assumptions (cont.) {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-   There an important assumption which is ***normality***.\n\n-   The Classical Regression Model or linear model, assumes all the conditional distributions are produced by a normal distribution or Gaussian distribution.\n\n::: callout-note\nThe conditional probability distribution functions $p(y|x)$ are normal distributions (as opposed to Bernoulli, Poisson, or other) for every $X = x$.[@westfall2020understanding].\n:::\n\n## Classical Regression Model: Assumptions (cont.) {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n@westfall2020understanding:\n\n![](regressionModel.png)\n\n## Classical Regression Model: Assumptions (cont.) {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n::: columns\n::: {.column width=\"40%\"}\n-   There is also an assumption of linearity.\n\n-   This assumption states that the means of the conditional distributions $p(y|x)$ fall precisely on a straight line of the form $\\beta_{0} + \\beta_{1}x$\n\n-   When we assume linearity the parameter $\\beta_{O}$ is the mean of $Y$ when the parameter $\\beta_{1} = 0$.\n\n-   To make $\\beta_{1} = 0$ we would just need to multiply it by zero: $\\beta_{0} + \\beta_{1}(0)$.\n\n-   But, what happens if $x$ does not have zero? Well, in that case, $\\beta_{0}$ would not be exactly the mean of $Y$ , instead $\\beta_{0}$ would be the vertical height or distance from zero.\n\n-   In this case, $\\beta_{1}$ is a parameter that indicates the difference between conditional means.\n:::\n\n::: {.column width=\"60%\"}\n@westfall2020understanding: ![](regress2.png)\n:::\n:::\n\n## Ordinary Least Squares {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-   I have mentioned before in class, the existence of a *line of best fit*\n\n-   This is the time to study what is this line.\n\n-   One fo the estimation methods in the Classical Regression Model is ***Ordinary Least Squares*** estimation.\n\n-   In this method, we draw a line in every possible direction, and calculate the distance of each value from the line. After calculating the distance form the line, we square those distances and add them together. This is what we call a Sum of Squares. The line that produces the lowest *Sum of Squares* is the ***line of best fit***.\n\n::: {#fig-plots layout-ncol=\"2\"}\n![](bestFit.png)\n\n![](sse.png)\n\n@field2012discovering and @westfall2020understanding\n:::\n\n## `Wage` data example {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-   By this point we should talk more about our applied example.\n\n-   Let's see what happens when we assume $\\beta_{1} = 0$ by just removing `age` from the regression model.\n\n```{r, echo=TRUE}\n\nfitModel <- lm(wage ~ 1, data = Wage)\nsummary(fitModel)\n\n```\n\n-   This is what we call the ***intercept only model***, it can also be considered a null model. Remember those words? In this model, we are not modeling any relationship. The regression model returns exactly the mean of `wage`. If you don't believe me you can see it:\n\n```{r, echo=TRUE}\nmean(Wage$wage)\n```\n\n-   It is the same value as the intercept!\n\n-   Let's add again `age` as a predictor:\n\n```{r, echo=TRUE}\n\nfitModel <- lm(wage ~ age, data = Wage)\nsummary(fitModel)\n\n```\n\n-   Now the coefficient for the estimated intercept changed. This happened because now the intercept represents the average wage when `age` is zero. But wait, you cannot have a zero age and get a salary? In this case, the intercept misses the interpretation, then it represents the height from zero.\n\n## `Wage` data example {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n```{r, echo = TRUE}\n#| code-fold: true\n#| code-summary: \"Show the code\"\n#| \nplot(Wage$age, Wage$wage, \n     pch = 16, \n     cex = 0.7, \n     col = \"blue\",\n     xlab = \"Age\",\n     ylab = \"Wage\",\n     main = \"Line of Best Fit Linear Regression\")\nabline(lm(wage ~ age, data = Wage), col = \"red\")\n\n\n```\n\n## `Wage` data example {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-   If we want to interpret the intercept in the way the linear model specifies. We can transform `age` to get a meaningful zero.\n\n-   There is something call $z$-values, others call it $z$-scores. This tranformation is based on the normal distribution.\n\n-   Let's see the formula to transform any continuous distribution into $z$ values:\n\n```{=tex}\n\\begin{equation}\nz= \\frac{x_{i}-\\bar{x}}{\\sigma}\n\\end{equation}\n```\nWhere: - $x_{i}$ is each observed value. - $\\bar{x}$ is the mean of the observed values. - $\\sigma$ is the standard deviation of the observed values.\n\n-   As you can see, what we do is to tranform the distribution, now the observed values will be centered at zero. It means the mean is going to be zero, and the values will be negative and positive values.\n\n-   In `R` you can transform any continiuos distributin into $z$-values using the function `scale()`.\n\n```{r, echo=TRUE}\nWage$age_Z <- scale(Wage$age)\nsummary(Wage[, c(\"age\", \"age_Z\")])\n```\n\n-   In the example above, you can see that the mean of `age` is now zero after transforming the distribution. Also, notice that `age_Z` ranges from -2.12 to 3.26.\n\n-   Given that now we have $z$-values we can interpret the values in terms of standard deviations from the mean. For instance, we can say that 18 years old is a value located -2.12 standard deviation below the mean (because the value is negative), we can also say that 80 years old is a value located 3.26 standard deviations above the mean (because the value is positive)\n\n## `Wage` data example {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\nLet's add `age_Z` variable to our regression model:\n\n```{r, echo = TRUE}\n#| code-fold: true\n#| code-summary: \"Show the code\"\n\nfitModel <- lm(wage ~ age_Z, data = Wage)\nsummary(fitModel)\n```\n\n-   Do you see what happened? After transforming `age` into values with a real zero, the intercept now shows the mean of `wage`. If you don't believe it, let's estimate again the mean of `wage`:\n\n```{r, echo=TRUE}\nmean(Wage$wage)\n```\n\n-   It is the same number! Then it is true, the intercept is the mean of $Y$ when $\\beta_{1}$ has a real zero among the possible values.\n\n-   Then we can interpret the result as: for 1-unit increment in `age_Z`, `wage` increases \\$816.37. Also you can say: for 1-standard deviation increment, `wage` increases \\$816.37.\n\n## `Wage` data example {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-   We can also transform `wage` into $z$-values, this will make the interpretation *fully standardized*:\n\n```{r, echo = TRUE}\n#| code-fold: true\n#| code-summary: \"Show the code\"\noptions(scipen = 999)\n\nWage$wage_Z <- scale(Wage$wage)\n\nsummary(lm(wage_Z ~ age_Z, data = Wage))\n\n```\n\n-   After standardizing `wage` we have an intercept that is almost zero, this makes sense because the mean of `wage` is now zero. It is actually zero, but models are not perfect, they are approximations, and there is randomness, that's why the intercept is not exactly zero.\n\n-   In this model, we could interpret the estimate of `age_Z` like it was a correlation, because it is standardized. We can also say: for 1-standard deviation increase in `age`, `wage` increases 0.20 standard deviations.\n\n## Fun fact: $t$-test is a linear regression extension {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-   Up to this point I have talked only about the case where the predictor has a continuous distribution. But, what happens when our predictor has discrete values (e.g gender, academic level)?\n\n-   The Classical Regression Models does not assume anything about the predictors. We can actually use any discrete variable.\n\n-   As always, we can understand what happens with a ***binary*** predictor by running an example:\n\n```{r, echo=TRUE}\n#| code-fold: true\n#| code-summary: \"Show the code\"\n\n### I'm going to transform the values, so I can get a variable where 1 = have insurance, 0 = does not have insurance.\n\nWage$dummyHealth <- ifelse(Wage$health_ins == \"2. No\", 0, 1)  ### This is a \"if else statement\".\n\n## Let's test if having an insurance predicts differences in wage\n\nfitWage <- lm(wage ~ dummyHealth, data = Wage)\n\nsummary(fitWage)\n\n```\n\n-   Let's digest the information from this example:\n\n    -   The model that we are fitting looks like this: $y_{wage} = \\beta_{0} + \\beta_{1}insuranceYES + \\epsilon$.\n    -   When the variable is discrete there is a reference group. Normally, the reference group is coded as $0$ and the target group is coded as $1$. This is tipically known as ***dummy coding***.\n\n-   The above table gave a value for the intercept. That intercept, in simple words; is the mean when $dummyHealth = 0$. The slope in the table is 27.922, that number is in simple terms ***the mean difference in wage between groups***.\n\n-   Don't you believe it? Let's see it next:\n\n## Fun fact: $t$-test is a linear regression extension {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\nFirst, let's see the mean of each group:\n\n```{r, echo=TRUE}\n#| code-fold: true\n#| code-summary: \"Show the code\"\n\nWage %>% select(dummyHealth, wage) %>% \n  group_by(dummyHealth) %>%\n  summarise(mean = mean(wage),\n            sd = sd(wage)) %>%\n  kbl(caption = \"Wage's mean and standard deviation by insurance status\") %>%\nkable_classic_2(\"hover\", full_width = F,bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\")) %>%\n  footnote(general = \"Not insurance = 0, Insurance = 1\")\n\n\n```\n\n-   In the table you can see that the mean of $Insurance = 0$ is 92.32! Just like we expected!\n\n-   Now let's compute the mean difference:\n\n```{r, echo=TRUE}\n\n120.2383-92.3167\n\n```\n\n-   Again! If you check our regression result the slope was 27.922, that's exactly the mean difference!\n\n-   What is the message here? When add ***dummy coded variables*** in a Classical Regression Model, you are measuring how far is the mean of $group = 0$ from $group = 1$, it simple words: ***it is a*** $t$-test.\n\n## Fun fact: $t$-test is a linear regression extension {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-Let's see it with a plot\n\n```{r, echo=TRUE}\n#| code-fold: true\n#| code-summary: \"Show the code\"\n\nplot(Wage$dummyHealth, Wage$wage,\n     xlab = \"Insurance Status\",\n     ylab = \"Wage\",\n     main = \"A scatterplot of wage by insurance status\",\n     xaxt = \"n\")\n\n# X-axis\naxis(1, at = c(0, 1))\nabline(lm(wage ~ dummyHealth, data = Wage), col = \"red\")\n```\n\n## What if my predictor has multiple categories? {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n-   You might wonder, what if my predictor has multiple groups?\n\n-   We can also transform multiple categories into several *dummy coded* variables, that means, the categories will become variables coded with $0$ or $1$.\n\n-   We can answer the following question:\n\n-   Is race related to wage? If so, how different is the average wage compared to White Americans?\n\n-   In the data set `Wage` there is a variable named `race`. We can check its values:\n\n```{r, echo=TRUE}\n#| code-fold: true\n#| code-summary: \"Show the code\"\n Wage %>% count(race) %>%\n   kbl(caption = \"Number of participants in each race group\")%>%\n  kable_classic_2(\"hover\", \n                  full_width = F,\n                  bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\"))\n```\n\n-   As you can see, we have 4 groups in this variable, and we need to create dummy variables.\n\n-   We should create $k-1$ new dummy variables, that means if you have 4 categories or groups, such as our case, we should have $4-1= 3$ new dummy variables:\n\n| Black | Asian | Other |\n|-------|-------|-------|\n| 0     | 0     | 0     |\n| 1     | 1     | 1     |\n| 0     | 1     | 1     |\n| ...   | ...   | ....  |\n\n-   Now we will create 3 new variables named `black`, `asian`, and `other`. Each variable will have only zeros and ones. Where $1 = YES$, and $0 = NO$.\n\n```{r, echo=TRUE}\n#| code-fold: true\n#| code-summary: \"Show the code\"\n\nWage <- Wage %>% mutate(black = ifelse(race == \"2. Black\", 1, 0),\n                        asian = ifelse(race == \"3. Asian\", 1, 0),\n                        other = ifelse(race == \"4. Other\", 1,0))\n\ndatatable(Wage %>% select(race, black,asian,other))\n\n```\n\n-   We are ready to estimate the regression model:\n\n```{r, echo=TRUE}\n#| code-fold: true\n#| code-summary: \"Show the code\"\n\nsummary(lm(wage ~ black + asian + other, data = Wage))\n\n```\n\n-   Did you notice that `white` is not in the model? That happens because we don't need it!\n\n-   If you do $k-1$ new dummy variables, you are already estimating the mean of `white` in the intercept.\n\n-   You don't believe me, right? Let's estimate the mean of white:\n\n```{r, echo=TRUE}\n#| code-fold: true\n#| code-summary: \"Show the code\"\n#| \nWage %>% filter(race == \"1. White\" ) %>%\n  summarise(mean = mean(wage),\n            sd = sd(wage)) %>%\n  kbl(caption = \"Mean of wage when participant is White\") %>%\n  kable_classic_2(\"hover\", \n                  full_width = F,\n                  bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\"))\n```\n\n-   Yes! I was right! The mean of white is exactly our intercept!\n\n-   Each slope estimated in our regression model is the mean difference compare to `white` group.\n\n-   Let's see if it true:\n\n```{r}\n#| code-fold: true\n#| code-summary: \"Show the code\"\n\nWage %>% group_by(race) %>% summarise(mean = mean(wage)) %>%\n  mutate(DifferenceVsWhite = c(0, \n                               101.60118\t- 112.56367\t, \n                               120.28829- 112.56367\t, \n                               89.97333 -112.56367)) %>% \n  kbl(caption = \"Mean Differences Compare to White\") %>%\n    kable_classic_2(\"hover\", \n                  full_width = F,\n                  bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\"))\n```\n\n-   Great! I was right again!\n\n# This is boring, let's add more predictor! {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n\n\n\n## Multiple predictors went to a bar... {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n- In the last example we added multiple predictors after creating ***dummy coded*** variables.\n\n- We estimated a model named *multiple regression*. Many authors prefered the word *multiple*\nto explicitly mention that there are more than one predictor. \n\n- When you add more predictors, the Classical Regression Model looks like this:\n\n\n```{=tex}\n\\begin{equation}\nY = \\beta_{0}+ \\beta_{1}X_{1} + \\beta_{2}X_{2} + ...+ \\epsilon \n\\end{equation}\n```\n\n- Now, this model will account for more possible variables related to $Y$.\n\n\n## Multiple predictors went to a bar... {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n\n\n```{r, echo=TRUE}\n#| code-fold: true\n#| code-summary: \"Show the code\"\n\nlibrary(scatterplot3d)\nrum <- read.csv(\"ruminationClean.csv\")\nfit <- lm(depreZ ~ rumZ + worryZ, data = rum)\n\nplot1 <- scatterplot3d(rum[c(\"rumZ\",\"worryZ\", \"depreZ\"  )], \n              angle = 60, \n              pch = 16,\n              color = \"steelblue\",\n              box = FALSE)\nplot1$plane3d(fit)\n\n\n```\n\n## Multiple predictors went to a bar... {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n- In the last example, I standardized the my outcome variable `depression`, I \nalso standardized the predictors `rumination` and `worry`. \n\n- I showed you that transforming the predictors and outcome unto $z$-values will \nhelp you to get stadardized estimates.\n\n-  This is not always necessary, may software will do something like this:\n\n\\begin{equation}\n r_{XY} = \\beta_{1}\\Big(\\frac{\\sigma_{X}}{\\sigma_{Y}}\\Big)\n\\end{equation}\n\n-Let's see if it works, I'll run a regression with the raw data and compare versus\na regression where I standardized the variables before fitting the model:\n\n\n\n```{r, echo = TRUE}\nsummary(lm(anx ~ worry, data = rum))\n\n```\n\n- Next, let's estimate the standarized slope:\n\n\n```{r, echo = TRUE}\n0.14384*(sd(rum$worry, na.rm = TRUE)/sd(rum$anx, na.rm = TRUE))\n\n```\n- Let's run again the same regression with standardized trasformed variables:\n\n```{r, echo=TRUE}\nsummary(lm(scale(anx) ~ worryZ, data = rum))\n```\n\n- Yes, they are the same. The software by default will use the  formula$\\beta_{1}\\Big(\\frac{\\sigma_{X}}{\\sigma_{Y}}\\Big)$ to standardize\nyour regression slopes, when you analyze your data using SPSS, SAS, STATA or\nother statistical packages outside `R`.\n\n\n\n## Multiple predictors went to a bar: non-linear models {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n- We have discussed that the assumption of a straight line\nexplaining all the conditional means is many times \nnot realistic. \n\n- We can actually fit a model where we give more freedom to the line.\n\n- How do we do this? We just have to add a polynomial term\nto the equation. For instance we could fit a quadractic \nregression model by doing something like this:\n\n\n```{=tex}\n\\begin{equation}\nY = \\beta_{0}+ \\beta_{1}X + \\beta_{2}X^2 + \\epsilon \n\\end{equation}\n```\n\n- Simply, we square the predictor. Let's do that with our `wage` data example:\n\n\n\n```{r, echo=TRUE}\n\n\nfitSq <- lm(wage ~ age + I(age^2), data = Wage)\nsummary(fitSq)\n\n```\n\n## Multiple predictors went to a bar: non-linear models {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n```{r, echo=TRUE}\n#| code-fold: true\n#| code-summary: \"Show the code\"\n#| \nggplot(Wage, aes(age, wage)) +\n      geom_point() +\n      stat_smooth(method = \"lm\", \n                  formula = y ~ x + I(x^2), \n                  size = 1) + \n  theme_classic()\n```\n\n## Multiple predictors went to a bar: non-linear models {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n- We could fit a model with a cubic term:\n\n```{=tex}\n\\begin{equation}\nY = \\beta_{0}+ \\beta_{1}X + \\beta_{2}X^2 + \\beta_{2}X^3 + \\epsilon \n\\end{equation}\n```\n\n\n\n```{r, echo=TRUE}\n#| code-fold: true\n#| code-summary: \"Show the code\"\n#| \nggplot(Wage, aes(age, wage)) +\n      geom_point() +\n      stat_smooth(method = \"lm\", \n                  formula = y ~ x + I(x^2) + I(x^3), \n                  size = 1) + \n  theme_classic()\n```\n\n## Multiple predictors went to a bar: non-linear models {.smaller .scrollable background-image=\"slide2.png\" background-opacity=\"0.5\"}\n\n- Let's add more flexibility:\n\n\n```{r, echo=TRUE}\n#| code-fold: true\n#| code-summary: \"Show the code\"\n#| \nggplot(Wage, aes(age, wage)) +\n      geom_point() +\n      stat_smooth(method = \"lm\", \n                  formula = y ~ x + I(x^2) + I(x^3) + I(x^4)+ I(x^5), \n                  size = 1) + \n  theme_classic()\n```\n\n\n\n## References {background-image=\"slide2.png\" background-opacity=\"0.5\"}\n"},"formats":{"revealjs":{"identifier":{"display-name":"RevealJS","target-format":"revealjs","base-format":"revealjs"},"execute":{"fig-width":10,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":false,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":true,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","html-math-method":{"method":"mathjax","url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML-full"},"slide-level":2,"to":"revealjs","self-contained":false,"output-file":"correlation&regressionPart2.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":false,"quarto-version":"1.3.353","auto-stretch":true,"title":"Correlation and Regression Models ","subtitle":"Part 2","author":"Esteban Montenegro-Montenegro, PhD","institute":"Psychology and Child Development","title-slide-attributes":{"data-background-image":"background1.png","data-background-opacity":"0.5"},"editor":"visual","bibliography":["references.bib"],"csl":"apa.csl","theme":["default","custom.scss"],"slideNumber":true,"chalkboard":{"theme":"whiteboard"}}}},"projectFormats":["html"]}